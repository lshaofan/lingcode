# Proposal: 添加操作模式选择

## Why

当前「聆码」只有一种固定的工作流程，但用户在不同场景下有不同的需求：

### 用户场景分析
1. **快速输入场景**：用户在编辑器或聊天工具中快速输入内容，希望语音转文字后直接插入，无需额外操作
2. **谨慎输入场景**：用户在重要文档或正式场合，希望在插入前先预览和确认转录内容，避免错误

### 当前痛点
- 缺少灵活性：用户无法根据场景选择工作流程
- 处理中状态冗余：悬浮球的"处理中"状态对用户体验帮助不大，增加了等待感
- 无法预览确认：转录后直接插入可能导致错误内容被输入

## What Changes

### 新增功能
1. **操作模式设置**
   - 模式一：**直接插入模式** (Direct Insert Mode)
     - 按下全局快捷键后立即开始录制
     - 显示最小化的录制悬浮窗（只显示录制状态）
     - 语音转文字完成后，直接插入到当前活动的文本框
     - 无需用户额外操作

   - 模式二：**预览确认模式** (Preview & Confirm Mode)
     - 按下全局快捷键后显示录制悬浮球
     - 语音实时转换为文本并在悬浮球中显示
     - 用户可选择：插入、复制或清空
     - 用户完全控制内容是否插入

2. **简化录制状态**
   - 移除"处理中"状态
   - 录制状态：录制中 → 转录完成（直接插入或显示预览）
   - 减少用户等待感知

3. **设置页面配置**
   - 在系统设置中添加"操作模式"选项
   - 提供清晰的模式说明和图示
   - 默认为"预览确认模式"（更安全）

### 涉及的技术栈
- **前端**：React + TypeScript，修改录制窗口逻辑
- **状态管理**：Zustand，新增 `operationMode` 设置
- **Rust 后端**：根据模式决定是否自动插入

## Impact

### 受影响的 Specs
- `operation-modes` (新增) - 操作模式管理
- `audio-recording` (修改) - 录制流程根据模式调整
- `text-insertion` (修改) - 插入逻辑根据模式执行
- `settings-ui` (修改) - 添加模式选择配置项

### 受影响的代码
- `src/stores/settingsStore.ts` - 添加 `operationMode` 设置项
- `src/windows/recording/RecordingFloat.tsx` - 修改录制窗口逻辑
- `src/stores/recordingStore.ts` - 修改录制状态管理
- `src/windows/main/settings/SystemSettings.tsx` - 添加模式选择 UI
- `src-tauri/src/commands/audio.rs` - 根据模式处理转录结果

### 用户体验变化
- **更灵活**：用户可根据场景选择工作模式
- **更快速**：直接插入模式减少操作步骤
- **更安全**：预览模式避免错误插入
- **更简洁**：移除冗余的"处理中"状态

## Risks & Mitigation

### 风险 1: 用户可能不理解两种模式的区别
- **影响**: 用户选择了不适合的模式
- **缓解**:
  - 提供清晰的模式说明和使用场景
  - 提供图示或动画演示
  - 默认使用更安全的预览模式
  - 允许用户随时切换

### 风险 2: 直接插入模式可能导致错误内容被输入
- **影响**: 转录错误的内容被插入到文档
- **缓解**:
  - 明确标注直接插入模式的风险
  - 提供撤销功能（系统级 Cmd+Z）
  - 保留历史记录，方便回溯

### 风险 3: 移除"处理中"状态可能让用户困惑
- **影响**: 用户不知道系统是否在处理
- **缓解**:
  - 在录制结束后立即显示简短的"转录中"提示
  - 使用进度指示器或加载动画
  - 确保转录速度足够快（< 2秒）

## Timeline

- **Week 1**: 添加 `operationMode` 设置项，修改录制流程
- **Week 2**: 实现两种模式的 UI 和逻辑，移除处理中状态
- **Week 3**: 测试和优化，添加模式切换动画

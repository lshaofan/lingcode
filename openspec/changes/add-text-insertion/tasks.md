# Tasks: 文本自动插入功能实施清单

## 1. 辅助功能权限管理
- [ ] 1.1 创建 macOS Accessibility 权限检查 (Objective-C)
- [ ] 1.2 实现权限申请引导流程
- [ ] 1.3 创建权限状态检测 Tauri Command
- [ ] 1.4 实现跳转到系统设置功能
- [ ] 1.5 创建权限提示 UI 组件
- [ ] 1.6 处理权限被拒绝情况

## 2. 活动窗口检测
- [ ] 2.1 实现获取当前活动应用 (macOS API)
- [ ] 2.2 获取应用 Bundle ID
- [ ] 2.3 获取应用名称和图标
- [ ] 2.4 检测光标位置（可选）
- [ ] 2.5 创建窗口信息 Tauri Command

## 3. 文本插入引擎
- [ ] 3.1 创建插入策略接口
- [ ] 3.2 实现键盘模拟插入 (enigo)
- [ ] 3.3 实现剪贴板粘贴插入
- [ ] 3.4 实现 Accessibility API 插入
- [ ] 3.5 实现策略自动选择
- [ ] 3.6 处理特殊字符转义
- [ ] 3.7 实现长文本分段插入
- [ ] 3.8 实现插入失败重试

## 4. 剪贴板管理
- [ ] 4.1 实现剪贴板内容备份
- [ ] 4.2 实现剪贴板恢复
- [ ] 4.3 处理剪贴板格式转换
- [ ] 4.4 添加剪贴板历史（可选）
- [ ] 4.5 实现剪贴板清理

## 5. 应用兼容性
- [ ] 5.1 测试常见应用兼容性
- [ ] 5.2 创建应用兼容性配置表
- [ ] 5.3 实现应用特定插入策略
- [ ] 5.4 维护应用黑名单
- [ ] 5.5 提供兼容性报告功能

## 6. Tauri Commands
- [ ] 6.1 实现 insert_text Command
- [ ] 6.2 实现 check_accessibility_permission Command
- [ ] 6.3 实现 get_active_application Command
- [ ] 6.4 实现 copy_to_clipboard Command

## 7. 错误处理
- [ ] 7.1 处理权限不足错误
- [ ] 7.2 处理插入失败错误
- [ ] 7.3 处理应用不兼容
- [ ] 7.4 实现降级方案
- [ ] 7.5 添加错误日志

## 8. UI 集成
- [ ] 8.1 创建插入结果提示
- [ ] 8.2 创建插入设置选项
- [ ] 8.3 显示插入状态
- [ ] 8.4 提供手动粘贴按钮

## 9. 测试
- [ ] 9.1 测试各种应用插入
- [ ] 9.2 测试特殊字符处理
- [ ] 9.3 测试长文本插入
- [ ] 9.4 测试剪贴板恢复
- [ ] 9.5 性能压力测试

### 优先级
- **P0**: 任务 1-4, 6
- **P1**: 任务 5, 7, 8
- **P2**: 任务 9

### 时间估算: 约 2-3 周

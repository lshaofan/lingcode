# Implementation Tasks

## 1. 数据模型和设置
- [ ] 1.1 在 `Settings` 接口中添加 `operationMode: 'direct' | 'preview'` 字段
- [ ] 1.2 在 `defaultSettings` 中设置默认值为 `'preview'`
- [ ] 1.3 更新 Rust 后端的设置持久化逻辑，支持新字段
- [ ] 1.4 验证设置的读取和保存功能

## 2. 设置页面 UI
- [ ] 2.1 在系统设置页面（`SystemSettings.tsx`）添加"操作模式"配置区域
- [ ] 2.2 实现 RadioGroup 组件展示两种模式选项
- [ ] 2.3 为每个模式添加说明文字：
   - 直接插入模式："录制完成后自动插入文字到当前应用，适合快速输入场景"
   - 预览确认模式："录制完成后先预览文字，由您决定是否插入，更加安全可控"
- [ ] 2.4 实现模式切换功能，调用 `updateSetting('operationMode', value)`
- [ ] 2.5 显示切换成功提示

## 3. 录制状态管理
- [ ] 3.1 在 `recordingStore.ts` 中添加当前操作模式的状态
- [ ] 3.2 简化录制状态类型，移除 `processing` 状态
- [ ] 3.3 添加 `transcriptionText` 字段用于存储转录结果
- [ ] 3.4 实现根据模式决定状态流转的逻辑

## 4. 直接插入模式实现
- [ ] 4.1 修改录制窗口（`RecordingFloat.tsx`），在直接插入模式下隐藏文字预览区域
- [ ] 4.2 转录完成后，调用文本插入 API（`insert_text`）
- [ ] 4.3 实现插入失败的降级方案（复制到剪贴板）
- [ ] 4.4 显示插入成功/失败的通知
- [ ] 4.5 插入完成后自动关闭录制窗口

## 5. 预览确认模式实现
- [ ] 5.1 修改录制窗口，在预览模式下显示完整的操作界面
- [ ] 5.2 转录完成后，在悬浮球中显示文字内容
- [ ] 5.3 实现"插入"按钮功能：调用插入 API 并关闭窗口
- [ ] 5.4 实现"复制"按钮功能：复制到剪贴板并显示提示
- [ ] 5.5 实现"清空"按钮功能：清除内容并关闭窗口

## 6. 状态简化
- [ ] 6.1 移除录制窗口中的"处理中"状态 UI
- [ ] 6.2 在转录过程中显示简短的"转录中"提示（使用加载指示器）
- [ ] 6.3 确保状态过渡流畅，无明显跳跃

## 7. 后端集成
- [ ] 7.1 修改 `audio.rs` 中的转录完成处理逻辑
- [ ] 7.2 读取当前的 `operationMode` 设置
- [ ] 7.3 在直接插入模式下，转录完成后触发 `insert_text` 事件
- [ ] 7.4 在预览模式下，转录完成后仅返回文本，不自动插入
- [ ] 7.5 处理插入失败的情况，发送错误事件

## 8. 用户体验优化
- [ ] 8.1 在设置页面添加模式切换的提示信息
- [ ] 8.2 确保模式切换立即生效，无需重启应用
- [ ] 8.3 在首次使用时显示操作模式的引导提示（可选）
- [ ] 8.4 优化转录速度，确保 < 2 秒完成

## 9. 测试
- [ ] 9.1 测试直接插入模式：录制 → 转录 → 自动插入
- [ ] 9.2 测试预览确认模式：录制 → 转录 → 预览 → 手动操作
- [ ] 9.3 测试模式切换功能
- [ ] 9.4 测试插入失败的降级方案
- [ ] 9.5 测试设置持久化（重启应用后保持选择）
- [ ] 9.6 测试各种边缘情况（无权限、空转录等）

## 10. 文档和清理
- [ ] 10.1 更新用户文档，说明两种操作模式
- [ ] 10.2 添加代码注释，解释模式判断逻辑
- [ ] 10.3 清理无用的"处理中"状态相关代码
- [ ] 10.4 运行 lint 和格式化工具

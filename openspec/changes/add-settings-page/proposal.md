# Proposal: 添加主窗口和设置管理系统

## Why

当前应用只有录音悬浮球功能,缺少一个完整的主窗口来提供:
- **转录历史查看** - 用户需要回顾今天的转录记录
- **快捷键提示** - 新用户需要了解如何使用全局快捷键
- **应用设置管理** - 用户需要配置快捷键、麦克风、语音识别模型等
- **系统行为控制** - 用户需要设置开机自启、Dock 显示等

这是应用的核心管理界面,为用户提供完整的控制中心和信息查看能力。

## What Changes

### 新增主窗口 UI 结构

创建一个完整的主窗口,采用**左侧导航 + 右侧内容**的布局:

**主导航菜单(左侧):**
- 📱 **首页** - 显示快捷键提示和今日转录历史
- 📝 **笔记** - 语音笔记功能(一期占位,显示"开发中")
- ⚙️ **设置** - 打开设置弹窗

### 1. 首页功能

**快捷键提示卡片:**
- 醒目显示全局快捷键使用方法
- 提示文字:"按住 ^ Ctrl + ⌥ Opt 在任何应用中听写"
- [查看使用方法] 按钮(可选)

**TODAY 转录历史列表:**
- 标题:"今天"
- 显示今日的所有转录记录
- 每条记录显示:
  - 时间戳(如 "09:21 PM")
  - 转录文本内容
- 按时间倒序排列
- 支持滚动查看更多记录

### 2. 笔记页面(一期占位)

**显示内容:**
- 居中的"此功能正在开发中,敬请期待"提示
- 简洁的空状态设计

**二期规划:**
- 语音快速笔记输入
- 笔记列表查看和管理
- 搜索和分类功能

### 3. 设置弹窗系统

点击"设置"菜单打开**弹窗式设置界面**,包含:

#### 设置弹窗结构
- **左侧**: 设置子菜单导航
- **右侧**: 对应的设置内容面板
- **底部**: 版本号显示(如 "聆码 v1.0.0")

#### 设置子菜单(3个)

**⚙️ 通用设置 (General)**
- 键盘快捷键配置
- 麦克风选择
- 语音识别语言选择

**💻 系统设置 (System)**
- 开机自动启动
- 在 Dock 中显示应用

**🤖 模型设置 (Model)** - 新增
- Whisper 模型选择(Base/Small/Medium/Large)
- 模型下载和管理
- 模型状态显示

### 详细功能设计

#### 通用设置面板

**1. 键盘快捷键**
- 显示当前快捷键组合(默认 "Cmd+Shift+S")
- [更改] 按钮打开快捷键录制界面
- 支持自定义快捷键组合
- 快捷键冲突检测

**2. 麦克风选择**
- 显示当前选择的麦克风设备
- [更改] 按钮打开麦克风选择列表
- 支持"自动检测"选项

**3. 语言选择**
- 显示当前语音识别语言(默认 "中文(简体)")
- [更改] 按钮打开语言选择弹窗

**语言选择弹窗:**
- 顶部:搜索框 + Auto-detect 开关
- 左侧:可选语言卡片(一期仅支持两种):
  - 🇨🇳 中文(简体) / Mandarin (Simplified)
  - 🇺🇸 英语 / English
- 右侧:"已选择"区域,显示当前选中的语言
- 底部:[保存并关闭] 按钮

#### 系统设置面板

**App settings 应用设置分组:**

**1. 开机自动启动 (Launch app at login)**
- Toggle 开关控制
- 开启后应用随系统启动
- 默认状态:关闭

**2. 在 Dock 中显示 (Show app in dock)**
- Toggle 开关控制
- 关闭后应用仅在托盘显示
- 默认状态:开启

#### 模型设置面板

**1. Whisper 模型选择**
- Radio Group 单选组:
  - ○ **Base** (74MB, 快速, 一般精度) - **推荐**
  - ○ **Small** (244MB, 较快, 较高精度)
  - ○ **Medium** (769MB, 较慢, 高精度)
  - ○ **Large** (1.5GB, 慢, 最高精度)

**每个模型选项显示:**
- 模型名称和标签(如"推荐")
- 文件大小
- 性能描述(速度和精度)
- 下载状态:
  - ✓ 已下载(绿色勾选标记)
  - [下载] 按钮(灰色,未下载时)
  - 进度条(下载中,显示百分比)

**2. 模型管理**
- 显示已下载模型列表
- 每个模型可单独删除(节省存储空间)
- 显示模型占用的磁盘空间

### UI 设计参考

参考 Flow 应用的设计风格:
- 简洁现代的视觉设计
- 卡片式设置项布局
- 绿色 Toggle 开关
- 柔和的圆角和阴影
- 清晰的视觉层次
- 中文界面语言

## Impact

### 受影响的 Specs
- `main-window-ui` (新增) - 主窗口 UI 规范,包含首页、笔记、设置导航
- `home-page` (新增) - 首页规范,包含快捷键提示和转录历史
- `settings-ui` (新增) - 设置弹窗 UI 规范
- `model-management` (新增) - Whisper 模型管理规范

### 受影响的代码
- `src/App.tsx` (重写) - 从演示界面改为主窗口布局
- `src/windows/main/` (新增) - 创建主窗口所有页面组件
  - `MainWindow.tsx` - 主窗口容器
  - `Sidebar.tsx` - 左侧导航栏
  - `HomePage.tsx` - 首页
  - `NotesPage.tsx` - 笔记页(占位)
  - `SettingsDialog.tsx` - 设置弹窗
  - `settings/GeneralSettings.tsx` - 通用设置面板
  - `settings/SystemSettings.tsx` - 系统设置面板
  - `settings/ModelSettings.tsx` - 模型设置面板
  - `settings/LanguageSelector.tsx` - 语言选择弹窗
- `src/stores/settingsStore.ts` (修改) - 可能需要扩展设置项
- `src/stores/historyStore.ts` (修改) - 历史记录状态管理
- `src/components/` (新增) - 新增通用 UI 组件
  - `Toggle.tsx` - Toggle 开关组件
  - `RadioGroup.tsx` - 单选组组件
  - `ProgressBar.tsx` - 进度条组件

### 依赖
- **Tauri Commands**:
  - `get_setting`, `set_setting` - 设置读写
  - `get_recent_transcriptions` - 获取转录历史
  - `list_audio_devices` - 获取麦克风列表
  - `download_model`, `delete_model` - 模型管理
  - `set_auto_launch`, `get_auto_launch` - 开机自启
- **系统 API**:
  - macOS 登录项 API(开机自启)
  - Dock 显示/隐藏 API
- **现有组件**: Button, Input, Modal 等基础组件

### 技术约束
- 设置弹窗应为模态对话框,背景遮罩处理
- 所有设置变更应立即保存到数据库
- 主题切换暂不实现(后续版本)
- 模型下载需要后台任务和进度追踪

## Risks

### 技术风险
- 模型文件较大(最大 1.5GB),下载可能失败或中断
- 开机自启在不同 macOS 版本可能有兼容性问题
- 快捷键冲突检测可能不完善

### 用户体验风险
- 一期笔记功能只是占位,用户可能产生困惑
- 模型下载时间较长,需要清晰的进度反馈
- 设置项过多可能导致用户困惑

### 缓解措施
- 模型下载支持断点续传
- 为占位功能添加明确的"开发中"提示
- 提供合理的默认设置,减少用户配置负担
- 添加设置项的说明文字和工具提示